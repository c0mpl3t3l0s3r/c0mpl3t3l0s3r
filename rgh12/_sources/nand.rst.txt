.. RGH documentation master file, created by
   sphinx-quickstart on Sun Aug 29 11:05:59 2021.
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

Nand Reading
======================

Getting a few backups of the consoles stock nand is crucial part of this process.

Not only is it needed to create a modified nand image, it can be used to return the console back to an unmodified state. The Nand stores the consoles 
cpu & dvd keys, fuse sets and critical system data. `Here <https://free60project.github.io/wiki/NAND_File_System/>`_ is a page that breaks down how the 
nand is formatted from a factory state and how it is modified.

Most motherboards have 16mb Nand, but some Jasper motherboards have larger 256 or 512mb nand chips
called a "Big Block Jasper". It can take significantly longer to read the consoles nand. 

V2 and V4 Corona motherboards come with a 4gb eMMC nands which requires either an sd card tool or an XFlasher to read and write the nand. 
Check `here <_images/coronaguide.jpg>`_ to bridge the resistor pads if neccessary depending on revision. `Here <https://weekendmodder.com/RGH-Corona4gb.html>`_
is a guide on dumping 4gb nands by WeekendModder.

These next few steps will show where to solder the read & write wires and 
how to read the nand from the console.

.. warning::
   Attempting this modification can permanently damage the console! Proceed with caution!
   

Nand Read & Write
***************************

Here is the 7-wire SPI-Nand reading cable that comes with most programmers.

.. image:: _images/nandxwire.jpg

*You may need to trim/strip the ends of this set of wires depending if they have connectors or not*

The Nand Read/Write header location in red.

.. image:: _images/motherboardnandloc.jpg

.. glossary::

Launch Model
	
	All Phat consoles have the same
	read & write header location.

	.. image:: _images/nandphat.jpg


Slim Model

	Since the slim consoles came with either a Trinity or Corona motherboard,
	the header points are oriented a bit different.

	**Trinity**

	.. image:: _images/trinitynand.jpg

	**Corona**

	.. image:: _images/corona.jpg


After the read & write wires are installed its time to read the consoles Nand.

Connecting to the console
***************************

Open J-Runner then move over to the console.
Connect the nand r/w wires to your programmer.
Here are the SPI-Nand connector on the XFlasher and JR-Programmer.


**XFlasher**

.. image:: _images/nandrw.jpg

*Be sure to turn the switch in orange to SPI mode for non eMMC nands*


**JR-Programmer**

.. image:: _images/nandrwjr.jpg

Connect power to the motherboard and the nand read & write wires to the programmer. 


.. warning::
	**Do not turn the console on it can cause damage to both the console & programmer!**


Connect a usb cable to the programmer and if the drivers installed correctly you should see the programmers icon in J-Runner shown below.

.. image:: _images/motherboard.gif

After getting everything connected ensure the console is connected to power but not turned on.

By default J-Runner has two Nand reads preselected.

A. Click "Read Nand"

.. image:: _images/nandread.gif

It may take a few minutes to read the nand, any bad blocks that may occur J-Runner remaps them automatically.

If any errors come up ie. "Device/Console Not Found" or "Flash Config" check the connections to the motherboard and programmer.


.. note::
	**Keep these files safe!**
	The "Show Working Folder" button in the bottom right is the default location for any files created & edited within J-Runner.

Once two nand reads are successful, it's time to create the ECC.
	
ECC Images
********************

The ECC or "Error Detection/Correction Code" section of the Nand processes the startup of the console.
Once the ECC is created and written a part of the nand will be overwritten with a bootloader called XeLL.

.. image:: _images/xell.png

XeLL or "Xenon Linux Loader" is a Linux based bootloader allowing access to the consoles
CPU/DVD keys, fuse sets and other critical system information. The CPU key
is needed to build a modified nand image called Freeboot. `Here <https://free60project.github.io/wiki/XeLL/>`_ 
is a page that explains more about XeLL and it's functions.

--------------------------------

**Creating & Writing ECC Images**
********************

Make sure "Dash Version" is set to 17559 and your motherboard revision is correct.

1. Select Glitch2 in the XeBuild section
2. Click "Create ECC"
3. Click "Write ECC"

.. image:: _images/ecc.gif

.. note::
	When clicking the "Create ECC" button it may ask to load a nand dump.
	Navigate to the nandump1.bin from the nand read. It may be there if 
	J-Runner hasn't been closed.
	
After the ECC is finished writing disconnect the programmer from the r/w wires on the motherboard
along with the power cables.







